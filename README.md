# ⛰️ 또닥또닥 산악회 관리자 시스템 (Admin System)

본 시스템은 **또닥또닥 산악회**의 운영 효율화를 위해 설계된 전용 관리 도구입니다. DuckDB의 강력한 뷰(View) 기능을 활용하여 회원들의 활동 상태를 실시간으로 추적하고 포인트 및 시상 내역을 관리합니다.

## 📖 운영자 매뉴얼 (Operator Manual)

### 1. 📅 일정 등록 및 관리
- **신규 등록**: `📅 이벤트 관리` 메뉴 하단의 빈 줄에 행사명, 날짜, 점수 등을 입력하고 `💾 일정 업데이트`를 클릭합니다.
- **앨범 링크**: 산행 종료 후 밴드 사진첩 주소를 `album_url` 컬럼에 붙여넣으면 보고서 생성 시 자동으로 포함됩니다.
- **조회 팁**: 상단의 연도/월 필터를 사용하면 특정 시점의 기록만 빠르게 편집할 수 있습니다.

### 2. 👥 회원 데이터 최신화
- **정보 수정**: `👥 회원 관리`에서 회원의 지역이나 생년 등을 수정할 수 있습니다. 
- **참석일 갱신**: 해당 메뉴에 진입할 때마다 시스템이 자동으로 모든 회원의 `최근 참석일`을 계산하여 업데이트합니다.
- **신입 등록**: 새로운 회원이 가입하면 하단 빈 줄에 정보를 입력하세요. `user_no`는 중복되지 않게 주의해야 합니다.

### 3. 🏃 참석 체크 및 명단 관리
- **월별 필터**: 먼저 상단의 월(Month) 버튼을 눌러 관리할 행사가 있는 달을 선택하세요.
- **인원 체크**: `selectbox`에서 행사를 선택한 후, 참석한 회원들을 `multiselect` 박스에서 모두 골라주세요.
- **저장**: 인원 수 확인 후 `💾 참석 명단 저장` 버튼을 누르면 DB에 즉시 기록됩니다.

### 4. 📊 월간 보고서 생성 (밴드 공지용)
- **대상 월 선택**: 보고서를 뽑고자 하는 달(YYYY-MM)을 입력하고 `📝 보고서 생성`을 클릭합니다.
- **탭 활용**:
    - **👀 미리보기**: 현재 데이터 기반으로 회원 상태(🌱, 😴🚨 등)와 시상 대상자가 맞는지 확인합니다.
    - **📋 밴드 복사용**: 박스 안의 텍스트를 전체 복사하여 네이버 밴드 게시글로 붙여넣습니다.
- **주의사항**: 보고서에 특정 행사가 누락되었다면, `📅 이벤트 관리`에서 해당 행사의 날짜가 정확한지 확인하세요.

---

## 🛠️ 유지보수 및 트러블슈팅

### Q. 특정 회원이 보고서 명단에서 보이지 않아요.
- **A**: 해당 회원의 `role`이 `exmember`(탈퇴)로 설정되어 있는지 확인하세요. 탈퇴 회원은 요약 보고서에서 제외됩니다.

### Q. 앨범 링크 버튼이 활성화되지 않아요.
- **A**: `📅 이벤트 관리` 메뉴에서 해당 행사의 `album_url` 칸이 비어있는지 확인하고 URL을 입력 후 저장하세요.

### Q. 데이터가 저장되지 않은 것 같아요.
- **A**: 모든 수정 후에는 반드시 해당 메뉴 하단의 **`💾 저장/업데이트` 버튼**을 눌러야 DB에 반영됩니다.

## 🗄️ 데이터베이스 스키마 (Database Schema)

시스템은 `members`와 `events`를 주축으로 하며, `attendees`가 이 둘을 잇는 N:M 관계를 형성합니다.

### 1. `members` (회원 정보)
회원의 고유 신상 정보와 기준 포인트를 관리합니다.
- **주요 컬럼**: `user_no`(PK), `name`, `birth_year`, `area`, `point`(기본점수), `role`, `last_attended`(최신 참석일), `created_at` 등

### 2. `events` (산행/행사 일정)
과거 및 향후 진행될 모든 행사 정보를 담고 있습니다.
- **주요 컬럼**: `event_id`(PK), `title`, `date`, `score`(참석 점수), `host`(주최자, FK), `album_url`(네이버 밴드 사진첩), `url`(공지링크)

### 3. `attendees` (참석 기록)
행사별 참석자 명단을 기록하는 연결 테이블입니다.
- **복합키**: `(event_id, user_no)`를 통해 중복 참석 기록을 방지하며 각 테이블의 참조 무결성을 유지합니다.

---

## 📊 핵심 로직: 활동 요약 뷰 (`v_member_attendance_summary`)

본 앱의 가장 중요한 데이터 소스로, 실시간 계산을 통해 아래 정보들을 제공합니다.

### 1. 포인트 산정 방식
- **현재포인트**: 기존 기본 점수(`point`) + 2025년 10월 이후의 행사 참석 점수(`score`)의 총합.
- **획득점수**: 현재 월(Month)에 참여하여 얻은 당월 점수.

### 2. 회원 상태 분류 알고리즘 (Status)
시스템이 자동으로 회원의 활동성을 분석하여 4가지 상태로 분류합니다.

| 아이콘 | 상태명 | 판별 기준 (Logic) |
| :---: | :--- | :--- |
| **`🌱`** | 신입 | 누적 포인트가 0점인 초기 가입 상태 |
| **`🌱🚨`** | 신입 경고 | 가입 후 3개월간 참석 기록 및 획득 포인트가 없는 경우 |
| **`😴🚨`** | 장기 미참석 | 누적 점수는 있으나 마지막 참석일로부터 6개월 이상 경과한 경우 |
| **`😎`** | 활동중 | 위 경고 조건에 해당하지 않는 정상 활동 회원 |



---

## 🚀 주요 메뉴 및 기능

### 1. 👥 회원 관리
- **다중 필터링**: 생년(기수)별, 지역별 멀티 셀렉트 필터를 지원하여 특정 그룹을 빠르게 조회합니다.
- **스마트 업데이트**: `st.data_editor`를 사용하여 엑셀처럼 정보를 수정하며, **변경된 필드만** 골라내어 효율적으로 DB를 업데이트합니다.

### 2. 📅 일정 및 앨범 관리
- **년/월 필터링**: 수많은 산행 기록 중 원하는 시점의 데이터만 골라 볼 수 있습니다.
- **앨범 URL 연동**: 각 행사별 사진첩 링크를 저장하고, 보고서 생성 시 자동으로 불러와 공지 편의성을 높입니다.

### 3. 🏃 참가 기록 체크
- **참가자 스크롤바**: 참석 인원이 많아도 UI가 깨지지 않도록 CSS 커스텀 스크롤바가 적용되어 있습니다.
- **월별 필터링**: 당월 행사만 리스트에 노출하여 관리 오작동을 방지합니다.

### 4. 📊 활동 결과 보고서 생성
- **자동 텍스트 생성**: 행사 내역, 참석 명단, 앨범 링크, 시상 대상자, 미참석 경고 명단을 한 번에 추출합니다.
- **밴드 게시 최적화**: 마크다운이 제거된 깔끔한 텍스트 형식을 제공하여 네이버 밴드에 즉시 복사-붙여넣기가 가능합니다.

---

## 🛠️ 기술 스택 (Tech Stack)
- **Framework**: Streamlit
- **Database**: DuckDB (In-process SQL)
- **Library**: Pandas, Tabulate

## 📝 설치 및 실행 (Setup)
```bash
pip install streamlit pandas duckdb
streamlit run app.py