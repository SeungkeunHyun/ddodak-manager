import streamlit as st
import importlib.metadata

# =========================================================
# 3. UI Layer - Layout & Common Components
# 사이드바, 헤더 등 공통 레이아웃을 관리합니다.
# =========================================================

class Layout:
    @staticmethod
    def render_sidebar(ai_model_name):
        """
        사이드바 메뉴를 렌더링하고 선택된 페이지를 반환합니다.
        """
        with st.sidebar:
            st.title("⛰️ 또닥 산악회")
            
            # 라이브러리 및 모델 정보 표시 (디버깅용)
            try: ver = importlib.metadata.version("google-generativeai")
            except: ver = "Unknown"
            
            st.caption(f"🛠️ Lib: v{ver} | 🤖 AI: {ai_model_name}")
            st.divider()
            
            # 네비게이션 메뉴
            return st.radio("메뉴 이동", ["🏠 홈", "👥 회원 관리", "📅 공지 관리", "🏃 참가 체크", "📊 보고서 생성"])

    @staticmethod
    def render_manual(page):
        """
        각 페이지 상단에 도움말(가이드)을 표시하는 토글형 컴포넌트입니다.
        """
        with st.expander(f"📖 {page} 페이지 이용 가이드", expanded=False):
            if page == "홈":
                st.markdown("""
                - **대시보드**: 전체 회원 수, 이달의 활동 점수 등 핵심 지표를 한눈에 확인하세요.
                - **다가오는 산행**: 가장 가까운 일정(3개)과 디데이, 서울 주간 날씨를 제공합니다.
                - **명예의 전당**: 이달의 공지왕, 참석왕(획득점수 순), 인기 산행 랭킹을 볼 수 있습니다.
                - **회원 통계**: 생년별 인원 및 성별 분포를 시각적으로 분석합니다.
                """)
            elif page == "회원 관리":
                st.markdown("""
                - **회원 검색**: 이름, 전화번호, 닉네임 등으로 회원을 빠르게 찾을 수 있습니다.
                - **회원 추가**: **테이블 우측 상단의 ➕ 아이콘**을 누르거나, **맨 아래의 빈 행**을 클릭하여 직접 입력하세요.
                - **수정/삭제**: 목록에서 내용을 직접 수정하거나, 행을 선택하여 삭제할 수 있습니다.
                """)
            elif page == "공지 관리":
                st.markdown("""
                - **일정 확인**: 달력(Calendar)보기와 리스트 보기를 지원합니다.
                - **일정 등록**: **테이블 우측 상단의 ➕ 아이콘**을 누르거나, **맨 아래의 빈 행**을 클릭하여 추가하세요.
                - **설정**: 날짜, 산 이름, 담당자 등을 입력하면 D-Day가 자동 계산됩니다.
                """)
            elif page == "참가 체크":
                st.markdown("""
                - **출석부**: 진행된 산행을 선택하고 참가자를 체크합니다.
                - **점수 자동 부여**: 참석 체크 시 활동 점수가 자동으로 누적됩니다.
                - **게스트 관리**: 비회원(게스트) 참가자도 별도로 기록할 수 있습니다.
                """)
            elif page == "보고서 생성":
                st.markdown("""
                - **엑셀 다운로드**: 전체 회원 명부나 산행 기록을 엑셀 파일로 저장합니다.
                - **월간/연간 보고**: 특정 기간의 활동 내역을 요약하여 보고서 형태로 출력합니다.
                """)
            st.caption("💡 팁: 화면이 좁다면 사이드바를 닫고 넓게 보실 수 있습니다.")
